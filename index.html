<!doctype html>
<meta charset="utf-8" />
<meta name="color-scheme" content="dark light" />
<meta name="robots" content="noindex" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>~</title>

<style>
  @font-face {
    font-family: 'NerdFont';
    font-style: normal;
    font-weight: 400;
    src:
      local('MesloLGS Nerd Font'),
      url('./fonts/MesloLGSNerdFont-Regular.woff2') format('woff2');
  }

  @font-face {
    font-family: 'NerdFont';
    font-style: normal;
    font-weight: 700;
    src:
      local('MesloLGS Nerd Font Bold'),
      url('./fonts/MesloLGSNerdFont-Bold.woff2') format('woff2');
  }

  :root {
    --color-background: #100f0f;
    --color-text-subtle: #888;
    --color-text: #eee;
    --font-family:
      NerdFont,
      'MesloLGS Nerd Font',
      ui-monospace,
      SFMono-Regular,
      Menlo,
      Monaco,
      Consolas,
      monospace;
    --font-size: clamp(16px, 1.5vw, 18px);
    --transition-speed: 200ms;
  }

  @media (prefers-color-scheme: light) {
    :root {
      --color-background: #e8e8e8;
      --color-text-subtle: #606060;
      --color-text: #111;
    }
  }
</style>

<script>
  const CONFIG = {
    commandPathDelimiter: '/',
    commandSearchDelimiter: ' ',
    defaultSearchTemplate: 'https://www.google.com/search?q={}',
    openLinksInNewTab: false,
    suggestionLimit: 4,
  };
  const COMMAND_ANIMATION_MS = 260;

  const PROFILE = new URLSearchParams(window.location.search).get('profile');
  let ACTIVE_PROFILE = PROFILE === 'work' ? 'work' : 'personal';
  document.documentElement.dataset.profile = ACTIVE_PROFILE;
  document.title = ACTIVE_PROFILE === 'work' ? '~ work' : '~ personal';

  // prettier-ignore
  const BASE_COMMANDS = new Map([
    ['a', { name: 'AI', searchTemplate: '/?q={}', suggestions: ['a/claude', 'a/gemini', 'a/grok', 'a/aws'], url: 'https://chatgpt.com' }],
    ['a/claude', { url: 'https://claude.ai/new' }],
    ['a/gemini', { url: 'https://gemini.google.com' }],
    ['a/grok', { url: 'https://grok.com' }],
    ['a/aws', { url: 'https://aws.amazon.com/bedrock/' }],
    ['b', { name: 'Bugcrowd', suggestions: ['b/bugcrowd'], url: 'https://identity.bugcrowd.com/login' }],
    ['b/bugcrowd', { url: 'https://identity.bugcrowd.com/login' }],
    ['c', { name: 'Cloudflare', suggestions: ['c/cloudflare'], url: 'https://dash.cloudflare.com' }],
    ['c/cloudflare', { url: 'https://dash.cloudflare.com' }],
    ['d', { name: 'Discord', suggestions: ['d/discord'], url: 'https://discord.com/channels/@me' }],
    ['d/discord', { url: 'https://discord.com/channels/@me' }],
    ['e', { name: 'PostHog', suggestions: ['e/posthog'], url: 'https://us.posthog.com' }],
    ['e/posthog', { url: 'https://us.posthog.com' }],
    ['f', { name: 'Figma', suggestions: ['f/figma'], url: 'https://www.figma.com' }],
    ['f/figma', { url: 'https://www.figma.com' }],
    ['g', { name: 'GitHub', searchTemplate: '/search?q={}', suggestions: ['g/github', 'g/copilot', 'g/trending'], url: 'https://github.com' }],
    ['g/github', { url: 'https://github.com' }],
    ['h', { name: 'Homelab', suggestions: ['h/homelab'], url: 'https://raslab.homes' }],
    ['h/homelab', { url: 'https://raslab.homes' }],
    ['i', { name: 'InstantDB', suggestions: ['i/instantdb'], url: 'https://instantdb.com/dash' }],
    ['i/instantdb', { url: 'https://instantdb.com/dash' }],
    ['l', { name: 'LinkedIn', suggestions: ['l/linkedin'], url: 'https://www.linkedin.com/feed/' }],
    ['l/linkedin', { url: 'https://www.linkedin.com/feed/' }],
    ['m', { name: 'Modal', suggestions: ['m/modal'], url: 'https://modal.com/apps' }],
    ['m/modal', { url: 'https://modal.com/apps' }],
    ['n', { name: 'Pinecone', suggestions: ['n/pinecone'], url: 'https://app.pinecone.io' }],
    ['n/pinecone', { url: 'https://app.pinecone.io' }],
    ['o', { name: 'OpenRouter', suggestions: ['o/openrouter'], url: 'https://openrouter.ai/models' }],
    ['o/openrouter', { url: 'https://openrouter.ai/models' }],
    ['p', { name: 'Proton', suggestions: ['p/drive', 'p/pass'], url: 'https://mail.proton.me/u/0/inbox' }],
    ['p/drive', { url: 'https://drive.proton.me/u/0' }],
    ['p/pass', { url: 'https://pass.proton.me/u/0' }],
    ['q', { name: 'QBO', suggestions: ['q/qbo'], url: 'https://qbo.intuit.com' }],
    ['q/qbo', { url: 'https://qbo.intuit.com' }],
    ['r', { name: 'Reddit', suggestions: ['r/reddit'], url: 'https://www.reddit.com' }],
    ['r/reddit', { url: 'https://www.reddit.com' }],
    ['rd', { url: 'https://app.rippling.com' }],
    ['s', { name: 'Supabase', suggestions: ['s/supabase'], url: 'https://supabase.com/dashboard/organizations' }],
    ['s/supabase', { url: 'https://supabase.com/dashboard/organizations' }],
    ['st', { url: 'https://selfh.st' }],
    ['t', { name: 'TickTick', suggestions: ['t/ticktick'], url: 'https://ticktick.com/webapp/#q/today/tasks' }],
    ['t/ticktick', { url: 'https://ticktick.com/webapp/#q/today/tasks' }],
    ['u', { name: 'Duolingo', suggestions: ['u/duolingo'], url: 'https://www.duolingo.com/learn' }],
    ['u/duolingo', { url: 'https://www.duolingo.com/learn' }],
    ['v', { name: 'Vercel', suggestions: ['v/vercel'], url: 'https://vercel.com/dashboard' }],
    ['v/vercel', { url: 'https://vercel.com/dashboard' }],
    ['x', { name: 'ð•', suggestions: ['x/jellyseerr', 'x/n8n'], url: 'https://x.com/home' }],
    ['x/jellyseerr', { url: 'https://jellyseerr.xvyz.co' }],
    ['x/n8n', { url: 'https://n8n.xvyz.co/home/workflows' }],
    ['y', { name: 'YouTube', searchTemplate: '/results?search_query={}', suggestions: ['y/youtube'], url: 'https://www.youtube.com/feed/subscriptions' }],
    ['y/youtube', { url: 'https://www.youtube.com/feed/subscriptions' }],
    ['0', { name: 'localhost', suggestions: ['0/localhost'], url: 'http://localhost:3000' }],
    ['0/localhost', { url: 'http://localhost:3000' }],
  ]);

  // prettier-ignore
  const WORK_COMMANDS = new Map([
    ['a', { name: 'AWS', suggestions: ['a/console', 'a/iam'], url: 'https://console.aws.amazon.com' }],
    ['a/console', { url: 'https://console.aws.amazon.com' }],
    ['a/iam', { url: 'https://us-east-1.console.aws.amazon.com/singlesignon/home' }],
    ['b', { name: 'Bugcrowd', suggestions: ['b/bugcrowd'], url: 'https://identity.bugcrowd.com/login' }],
    ['b/bugcrowd', { url: 'https://identity.bugcrowd.com/login' }],
    ['c', { name: 'Confluence', suggestions: ['c/confluence', 'c/calendar', 'c/cursor'], url: 'https://www.atlassian.com/software/confluence' }],
    ['c/confluence', { url: 'https://www.atlassian.com/software/confluence' }],
    ['c/calendar', { url: 'https://calendar.google.com' }],
    ['c/cursor', { url: 'https://cursor.com' }],
    ['d', { name: 'Drive', suggestions: ['d/drive'], url: 'https://drive.google.com' }],
    ['d/drive', { url: 'https://drive.google.com' }],
    ['g', { name: 'GitHub', searchTemplate: '/search?q={}', suggestions: ['g/github', 'g/copilot', 'g/trending'], url: 'https://github.com' }],
    ['g/github', { url: 'https://github.com' }],
    ['i', { name: 'incident.io', suggestions: ['i/incident'], url: 'https://app.incident.io' }],
    ['i/incident', { url: 'https://app.incident.io' }],
    ['j', { name: 'Jira', suggestions: ['j/jira'], url: 'https://www.atlassian.com/software/jira' }],
    ['j/jira', { url: 'https://www.atlassian.com/software/jira' }],
    ['m', { name: 'Work Mail', suggestions: ['m/mail'], url: 'https://mail.google.com' }],
    ['m/mail', { url: 'https://mail.google.com' }],
    ['r', { name: 'Rippling', suggestions: ['r/rippling'], url: 'https://app.rippling.com' }],
    ['r/rippling', { url: 'https://app.rippling.com' }],
    ['s', { name: 'Slack', suggestions: ['s/slack'], url: 'https://app.slack.com/client' }],
    ['s/slack', { url: 'https://app.slack.com/client' }],
    ['w', { name: 'Wiz', suggestions: ['w/wiz'], url: 'https://app.wiz.io' }],
    ['w/wiz', { url: 'https://app.wiz.io' }],
    ['z', { name: 'Zoom', suggestions: ['z/zoom'], url: 'https://app.zoom.us/wc/home' }],
    ['z/zoom', { url: 'https://app.zoom.us/wc/home' }],
  ]);

  let COMMANDS = ACTIVE_PROFILE === 'work' ? WORK_COMMANDS : BASE_COMMANDS;

  const setActiveProfile = (profile, options = {}) => {
    const nextProfile = profile === 'work' ? 'work' : 'personal';
    const { animate = true } = options;
    if (nextProfile === ACTIVE_PROFILE) return;
    const previousProfile = ACTIVE_PROFILE;
    const previousCommands = COMMANDS;
    ACTIVE_PROFILE = nextProfile;
    COMMANDS = ACTIVE_PROFILE === 'work' ? WORK_COMMANDS : BASE_COMMANDS;
    document.documentElement.dataset.profile = ACTIVE_PROFILE;
    document.title = ACTIVE_PROFILE === 'work' ? '~ work' : '~ personal';
    window.dispatchEvent(
      new CustomEvent('profilechange', {
        detail: {
          animate,
          nextCommands: COMMANDS,
          nextProfile: ACTIVE_PROFILE,
          previousCommands,
          previousProfile,
        },
      })
    );
  };

  const openProfile = (profile) => {
    const url = new URL(window.location.href);
    if (profile === 'work') url.searchParams.set('profile', 'work');
    else url.searchParams.delete('profile');
    window.history.replaceState({}, '', url);
    setActiveProfile(profile, { animate: true });
  };

  document.addEventListener(
    'keydown',
    (event) => {
      const isShiftW =
        event.shiftKey &&
        event.key.toLowerCase() === 'w' &&
        !event.altKey &&
        !event.ctrlKey &&
        !event.metaKey;
      const isShiftQ =
        event.shiftKey &&
        event.key.toLowerCase() === 'q' &&
        !event.altKey &&
        !event.ctrlKey &&
        !event.metaKey;

      if (!isShiftW && !isShiftQ) return;
      event.preventDefault();
      event.stopImmediatePropagation();
      if (isShiftW) openProfile('work');
      if (isShiftQ) openProfile('personal');
    },
    true
  );
</script>

<template id="commands-template">
  <style>
    nav {
      align-items: center;
      box-sizing: border-box;
      display: flex;
      justify-content: center;
      min-height: 100dvh;
      padding: 4rem 0;
      width: 100%;
    }

    .commands {
      display: inline-grid;
      grid-template-columns: 1fr 1fr;
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .command {
      align-items: center;
      color: var(--color-text);
      display: flex;
      height: 4em;
      justify-content: center;
      outline: 0;
      position: relative;
      text-align: center;
      text-decoration: none;
      transition:
        color var(--transition-speed),
        opacity 260ms cubic-bezier(0.22, 1, 0.36, 1),
        transform 260ms cubic-bezier(0.22, 1, 0.36, 1);
      will-change: opacity, transform;
      width: 4em;
    }

    .command.enter {
      opacity: 0;
      transform: translateY(0.5em) scale(0.96);
    }

    .command.exit {
      opacity: 0;
      pointer-events: none;
      transform: translateY(-0.5em) scale(0.96);
    }

    .key {
      color: var(--color-text-subtle);
      position: absolute;
      transition:
        opacity var(--transition-speed) ease,
        transform var(--transition-speed) ease;
    }

    .command:where(:focus, :hover) .key {
      opacity: 0;
      pointer-events: none;
      transform: translateY(1.5em) scale(0.9);
    }

    .name {
      opacity: 0;
      pointer-events: none;
      transform: translateY(-1.5em) scale(0.9);
      transition:
        opacity var(--transition-speed) ease,
        transform var(--transition-speed) ease;
    }

    .command:where(:focus, :hover) .name {
      opacity: 1;
      transform: translateY(0);
    }

    @media (min-width: 60rem) {
      .commands {
        grid-template-columns: repeat(var(--desktop-command-columns, 11), 1fr);
      }
    }
  </style>
  <nav>
    <menu class="commands"></menu>
  </nav>
</template>

<template id="command-template">
  <li>
    <a class="command" rel="noopener noreferrer">
      <span class="key"></span>
      <span class="name"></span>
    </a>
  </li>
</template>

<script type="module">
  class Commands extends HTMLElement {
    #commands;
    #commandTemplate;
    #entries = new Map();

    constructor() {
      super();
      this.attachShadow({ mode: 'open' });
      const template = document.getElementById('commands-template');
      const clone = template.content.cloneNode(true);
      this.#commands = clone.querySelector('.commands');
      this.#commandTemplate = document.getElementById('command-template');
      this.#render(COMMANDS, false);
      window.addEventListener('profilechange', this.#onProfileChange);

      this.shadowRoot.append(clone);
    }

    disconnectedCallback() {
      window.removeEventListener('profilechange', this.#onProfileChange);
    }

    #onProfileChange = (event) => {
      this.#render(event.detail.nextCommands, event.detail.animate);
    };

    #setCommandElement(command, key, name, url) {
      command.href = url;
      if (CONFIG.openLinksInNewTab) command.target = '_blank';
      else command.removeAttribute('target');
      command.querySelector('.key').innerText = key;
      command.querySelector('.name').innerText = name;
    }

    #setDesktopColumns(commandCount) {
      const columns =
        commandCount <= 11 ? commandCount : Math.ceil(commandCount / 2);
      this.#commands.style.setProperty(
        '--desktop-command-columns',
        String(Math.max(1, columns))
      );
    }

    #render(nextCommands, animate) {
      const nextEntries = Array.from(nextCommands.entries()).filter(
        ([, value]) => value?.name && value?.url
      );
      this.#setDesktopColumns(nextEntries.length);
      const nextKeys = new Set(nextEntries.map(([key]) => key));

      for (const [key, item] of this.#entries) {
        if (nextKeys.has(key)) continue;
        const command = item.querySelector('.command');
        if (animate) {
          command.classList.add('exit');
          setTimeout(() => item.remove(), COMMAND_ANIMATION_MS);
        } else {
          item.remove();
        }
        this.#entries.delete(key);
      }

      for (const [key, { name, url }] of nextEntries) {
        let item = this.#entries.get(key);
        if (!item) {
          const clone = this.#commandTemplate.content.cloneNode(true);
          item = clone.querySelector('li');
          this.#entries.set(key, item);
          const command = item.querySelector('.command');
          this.#setCommandElement(command, key, name, url);
          if (animate) {
            command.classList.add('enter');
            requestAnimationFrame(() => {
              requestAnimationFrame(() => command.classList.remove('enter'));
            });
          }
        } else {
          this.#setCommandElement(item.querySelector('.command'), key, name, url);
        }
      }

      for (const [key] of nextEntries) {
        const item = this.#entries.get(key);
        if (item) this.#commands.append(item);
      }
    }
  }

  customElements.define('commands-component', Commands);
</script>

<template id="search-template">
  <style>
    input,
    button {
      -moz-appearance: none;
      font-family: var(--font-family);
      -webkit-appearance: none;
      background: transparent;
      border: 0;
      display: block;
      outline: 0;
    }

    .dialog {
      align-items: center;
      background: var(--color-background);
      border: none;
      display: none;
      flex-direction: column;
      height: 100%;
      justify-content: center;
      left: 0;
      padding: 0;
      top: 0;
      width: 100%;
    }

    .dialog[open] {
      display: flex;
    }

    .form {
      width: 100%;
    }

    .input {
      color: var(--color-text);
      font-size: 2rem;
      font-weight: bold;
      padding: 0;
      text-align: center;
      width: 100%;
    }

    .suggestions {
      align-items: center;
      display: flex;
      flex-direction: column;
      flex-wrap: wrap;
      justify-content: center;
      list-style: none;
      margin: 1rem 0 0;
      min-height: 3rem;
      overflow: hidden;
      padding: 0;
    }

    .suggestion {
      color: var(--color-text);
      cursor: pointer;
      font-size: 1rem;
      padding: 1rem;
      position: relative;
      transition: color var(--transition-speed);
      white-space: nowrap;
      z-index: 1;
    }

    .suggestion:where(:focus, :hover) {
      color: var(--color-background);
    }

    .suggestion::before {
      background-color: var(--color-text);
      border-radius: 0.1em;
      content: ' ';
      inset: 0.9em 0.5em;
      opacity: 0;
      position: absolute;
      transform: translateY(0.3em) scale(0.9);
      transition: all var(--transition-speed);
      z-index: -1;
    }

    .suggestion:where(:focus, :hover)::before {
      opacity: 1;
      transform: translateY(0);
    }

    .match {
      color: var(--color-text-subtle);
      transition: color var(--transition-speed);
    }

    .suggestion:where(:focus, :hover) .match {
      color: var(--color-background);
    }

    @media (min-width: 700px) {
      .suggestions {
        flex-direction: row;
      }
    }
  </style>
  <dialog class="dialog">
    <form autocomplete="off" class="form" method="dialog" spellcheck="false">
      <input class="input" title="search" type="text" />
      <menu class="suggestions"></menu>
    </form>
  </dialog>
</template>

<template id="suggestion-template">
  <li>
    <button class="suggestion" type="button"></button>
  </li>
</template>

<template id="match-template">
  <span class="match"></span>
</template>

<script type="module">
  class Search extends HTMLElement {
    #dialog;
    #form;
    #input;
    #suggestions;

    constructor() {
      super();
      this.attachShadow({ mode: 'open' });
      const template = document.getElementById('search-template');
      const clone = template.content.cloneNode(true);
      this.#dialog = clone.querySelector('.dialog');
      this.#form = clone.querySelector('.form');
      this.#input = clone.querySelector('.input');
      this.#suggestions = clone.querySelector('.suggestions');
      this.#form.addEventListener('submit', this.#onSubmit, false);
      this.#input.addEventListener('input', this.#onInput);
      this.#suggestions.addEventListener('click', this.#onSuggestionClick);
      document.addEventListener('keydown', this.#onKeydown);
      this.shadowRoot.append(clone);
    }

    static #escapeRegexCharacters(s) {
      return s.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
    }

    static async #fetchGoogleSuggestions(search) {
      try {
        const response = await fetch(
          `https://suggestqueries.google.com/complete/search?client=firefox&q=${encodeURIComponent(search)}`
        );

        if (!response.ok) return [];
        const data = await response.json();
        const suggestions = Array.isArray(data?.[1]) ? data[1] : [];

        return suggestions.filter(
          (suggestion) => suggestion.toLowerCase() !== search.toLowerCase()
        );
      } catch {
        return [];
      }
    }

    static #formatSearchUrl(template, search) {
      return template.replace(/{}/g, encodeURIComponent(search));
    }

    static #parseDirectUrl(query) {
      if (!/^https?:\/\//i.test(query)) return null;

      try {
        const url = new URL(query);
        if (!url.hostname) return null;
        return url.toString();
      } catch {
        return null;
      }
    }

    static #parseQuery = (raw) => {
      const query = raw.trim();
      const directUrl = Search.#parseDirectUrl(query);
      if (directUrl) return { query, url: directUrl };

      if (COMMANDS.has(query)) {
        const { url } = COMMANDS.get(query);
        const key = query;
        return { key, query, url };
      }

      let splitBy = CONFIG.commandSearchDelimiter;
      const [searchKey, rawSearch] = query.split(new RegExp(`${splitBy}(.*)`));

      if (COMMANDS.has(searchKey)) {
        const command = COMMANDS.get(searchKey);
        const template = new URL(command.searchTemplate ?? '', command.url);
        const search = rawSearch.trim();
        const url = Search.#formatSearchUrl(decodeURI(template.href), search);
        return { key: searchKey, query, search, splitBy, url };
      }

      splitBy = CONFIG.commandPathDelimiter;
      const [pathKey, path] = query.split(new RegExp(`${splitBy}(.*)`));

      if (COMMANDS.has(pathKey)) {
        const command = COMMANDS.get(pathKey);
        const url = `${new URL(command.url).origin}/${path}`;
        return { key: pathKey, path, query, splitBy, url };
      }

      const url = Search.#formatSearchUrl(CONFIG.defaultSearchTemplate, query);
      return { query, search: query, url };
    };

    #close() {
      this.#input.value = '';
      this.#input.blur();
      this.#dialog.close();
      this.#suggestions.innerHTML = '';
    }

    #execute(query) {
      const target = CONFIG.openLinksInNewTab ? '_blank' : '_self';
      window.open(Search.#parseQuery(query).url, target, 'noopener noreferrer');
      this.#close();
    }

    #focusNextSuggestion(previous = false) {
      const active = this.shadowRoot.activeElement;
      let nextIndex;

      if (active.dataset.index) {
        const activeIndex = Number(active.dataset.index);
        nextIndex = previous ? activeIndex - 1 : activeIndex + 1;
      } else {
        nextIndex = previous ? this.#suggestions.childElementCount - 1 : 0;
      }

      const next = this.#suggestions.children[nextIndex];
      if (next) next.querySelector('.suggestion').focus();
      else this.#input.focus();
    }

    #onInput = async () => {
      const oq = Search.#parseQuery(this.#input.value);

      if (!oq.query) {
        this.#close();
        return;
      }

      let suggestions = COMMANDS.get(oq.query)?.suggestions ?? [];

      if (
        oq.search?.length > 1 &&
        suggestions.length < CONFIG.suggestionLimit
      ) {
        const res = await Search.#fetchGoogleSuggestions(oq.search);

        suggestions = suggestions
          .concat(
            oq.splitBy
              ? res.map((search) => `${oq.key}${oq.splitBy}${search}`)
              : res
          )
          .slice(0, CONFIG.suggestionLimit);
      }

      const nq = Search.#parseQuery(this.#input.value);
      if (nq.query !== oq.query) return;
      this.#renderSuggestions(suggestions, oq.query);
    };

    #onKeydown = (e) => {
      if (!this.#dialog.open) {
        this.#dialog.show();
        this.#input.focus();

        requestAnimationFrame(() => {
          // close the search dialog before the next repaint if a character is
          // not produced (e.g. if you type shift, control, alt etc.)
          if (!this.#input.value) this.#close();
        });

        return;
      }

      if (e.key === 'Escape') {
        this.#close();
        return;
      }

      const alt = e.altKey ? 'alt-' : '';
      const ctrl = e.ctrlKey ? 'ctrl-' : '';
      const meta = e.metaKey ? 'meta-' : '';
      const shift = e.shiftKey ? 'shift-' : '';
      const modifierPrefixedKey = `${alt}${ctrl}${meta}${shift}${e.key}`;

      if (/^(ArrowDown|Tab|ctrl-n)$/.test(modifierPrefixedKey)) {
        e.preventDefault();
        this.#focusNextSuggestion();
        return;
      }

      if (/^(ArrowUp|ctrl-p|shift-Tab)$/.test(modifierPrefixedKey)) {
        e.preventDefault();
        this.#focusNextSuggestion(true);
      }
    };

    #onSubmit = () => {
      this.#execute(this.#input.value);
    };

    #onSuggestionClick = (e) => {
      const ref = e.target.closest('.suggestion');
      if (!ref) return;
      this.#execute(ref.dataset.suggestion);
    };

    #renderSuggestions(suggestions, query) {
      this.#suggestions.innerHTML = '';
      const template = document.getElementById('suggestion-template');

      for (const [index, suggestion] of suggestions.entries()) {
        const clone = template.content.cloneNode(true);
        const ref = clone.querySelector('.suggestion');
        ref.dataset.index = index;
        ref.dataset.suggestion = suggestion;
        const escapedQuery = Search.#escapeRegexCharacters(query);
        const matched = suggestion.match(new RegExp(escapedQuery, 'i'));

        if (matched) {
          const template = document.getElementById('match-template');
          const clone = template.content.cloneNode(true);
          const matchRef = clone.querySelector('.match');
          const pre = suggestion.slice(0, matched.index);
          const post = suggestion.slice(matched.index + matched[0].length);
          matchRef.innerText = matched[0];
          ref.append(pre, clone, post);
        } else {
          ref.innerText = suggestion;
        }

        this.#suggestions.append(clone);
      }
    }
  }

  customElements.define('search-component', Search);
</script>

<style>
  @keyframes work-background-flow {
    0% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
    100% {
      background-position: 0% 50%;
    }
  }

  @keyframes personal-background-flow {
    0% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
    100% {
      background-position: 0% 50%;
    }
  }

  .date-time {
    background: rgba(10, 10, 10, 0.36);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 0.6rem;
    box-shadow: 0 6px 24px rgba(0, 0, 0, 0.22);
    color: var(--color-text-subtle);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    display: grid;
    gap: 0.1rem;
    left: 1.25rem;
    line-height: 1.15;
    padding: 0.45rem 0.65rem 0.5rem;
    pointer-events: none;
    position: fixed;
    top: 1.25rem;
    transition:
      background-color var(--transition-speed) ease,
      border-color var(--transition-speed) ease,
      color var(--transition-speed) ease,
      box-shadow var(--transition-speed) ease;
    z-index: 10;
  }

  .date-time .time {
    color: var(--color-text);
    font-size: 0.98rem;
    font-variant-numeric: tabular-nums;
    letter-spacing: 0.02em;
    text-shadow: 0 1px 0 rgba(0, 0, 0, 0.2);
  }

  .date-time .date {
    font-size: 0.72rem;
    font-variant-numeric: tabular-nums;
    letter-spacing: 0.07em;
    text-transform: uppercase;
  }

  html {
    background-color: var(--color-background);
    font-family: var(--font-family);
    font-size: var(--font-size);
    line-height: 1.4;
    user-select: none;
  }

  html[data-profile='personal'] {
    background-image: linear-gradient(
      120deg,
      #020707 0%,
      #031414 12%,
      #042121 26%,
      #063131 42%,
      #074242 58%,
      #0a4d4d 74%,
      #0b4f4f 88%,
      #0a4545 100%
    );
    background-size: 260% 260%;
    animation: personal-background-flow 25s ease infinite;
  }

  html[data-profile='work'] {
    --color-background: #050505;
    --color-text: #ede5ff;
    --color-text-subtle: #ab9ecf;
    background-image: linear-gradient(
      120deg,
      #020202 0%,
      #09060f 14%,
      #120a1f 30%,
      #1a0f2f 46%,
      #241344 62%,
      #2a1745 78%,
      #2d1a3a 90%,
      #28172d 100%
    );
    background-size: 260% 260%;
    animation: work-background-flow 25s ease infinite;
  }

  html[data-profile='work'] .date-time {
    background: rgba(15, 10, 26, 0.42);
    border-color: rgba(171, 158, 207, 0.35);
    box-shadow:
      0 8px 28px rgba(12, 8, 24, 0.42),
      inset 0 0 0 1px rgba(171, 158, 207, 0.08);
  }

  body {
    margin: 0;
  }
</style>

<div class="date-time" aria-live="off">
  <div class="time"></div>
  <div class="date"></div>
</div>
<script>
  const dateTime = document.querySelector('.date-time');
  const timeNode = dateTime?.querySelector('.time');
  const dateNode = dateTime?.querySelector('.date');
  const timeFormatter = new Intl.DateTimeFormat([], {
    hour: '2-digit',
    hour12: false,
    minute: '2-digit',
  });
  const dateFormatter = new Intl.DateTimeFormat([], {
    day: '2-digit',
    month: 'long',
  });

  const updateDateTime = () => {
    const now = new Date();
    if (timeNode) timeNode.textContent = timeFormatter.format(now);
    if (dateNode) dateNode.textContent = dateFormatter.format(now);
  };

  updateDateTime();
  setInterval(updateDateTime, 1000);
</script>
<commands-component></commands-component>
<search-component></search-component>
